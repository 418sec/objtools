"use strict";

var expect = require("chai").expect;
var objtools = require("../lib");
var ObjectMask = objtools.ObjectMask;

describe("ObjectMask", function () {

	var obj1 = {
		str1: "string",
		str2: "string2",
		num1: 1,
		num2: 2,
		nul1: null,
		nul2: null,
		undef: undefined,
		obj: {
			foo: "test",
			bar: "test2",
			baz: "test3"
		},
		arr: [{
			str1: "one",
			str2: "two"
		}, {
			str1: "three",
			str2: "four"
		}]
	};

	var mask1 = {
		str1: true,
		str2: true,
		num1: true,
		nul1: true,
		nul2: true,
		obj: {
			foo: true,
			bar: true
		},
		arr: [{
			str1: true
		}]
	};

	var mask2 = {
		str1: true,
		num2: true,
		nul2: true,
		obj: {
			_: true,
			foo: false
		},
		arr: [{
			str2: true
		}]
	};

	describe("filterObject()", function () {

		it("basic functionality", function (done) {
			obj1 = objtools.deepCopy(obj1);
			var result;
			result = new ObjectMask({
				str1: true,
				num1: true,
				nul1: true,
				obj: {
					bar: true,
					nonexist: true
				}
			}).filterObject(obj1);
			expect(result).to.deep.equal({
				str1: "string",
				num1: 1,
				nul1: null,
				obj: {
					bar: "test2"
				}
			});
			done();
		});

		it("arrays and wildcards", function (done) {
			obj1 = objtools.deepCopy(obj1);
			var result;
			result = new ObjectMask({
				obj: {
					_: true,
					bar: false
				},
				arr: [{
					str2: true
				}]
			}).filterObject(obj1);
			expect(result).to.deep.equal({
				obj: {
					foo: "test",
					baz: "test3"
				},
				arr: [{
					str2: "two"
				}, {
					str2: "four"
				}]
			});
			done();
		});

		it("getSubMask()", function (done) {
			expect(new ObjectMask({
				foo: {
					bar: {
						baz: true
					}
				}
			}).getSubMask("foo").toObject()).to.deep.equal({
				bar: {
					baz: true
				}
			});
			done();
		});

		it("checkPath()", function (done) {
			expect(new ObjectMask(mask1).checkPath("arr.8.str1")).to.be.true;
			expect(new ObjectMask(mask1).checkPath("arr.8.str2")).to.be.false;
			done();
		});

		it("addMasks()", function (done) {
			expect(ObjectMask.addMasks(new ObjectMask(mask1), new ObjectMask(mask2)).toObject()).to.deep.equal({
				str1: true,
				str2: true,
				num1: true,
				num2: true,
				nul1: true,
				nul2: true,
				obj: {
					_: true
				},
				arr: {
					_: {
						str1: true,
						str2: true
					}
				}
			});
			done();
		});

		it("andMasks()", function (done) {
			expect(ObjectMask.andMasks(new ObjectMask(mask1), new ObjectMask(mask2)).toObject()).to.deep.equal({
				str1: true,
				nul2: true,
				obj: {
					bar: true
				}
			});
			done();
		});

		it("validate()", function (done) {
			expect(new ObjectMask(mask1).validate()).to.be.true;
			expect(new ObjectMask(mask2).validate()).to.be.true;
			expect(new ObjectMask({
				foo: new Date()
			}).validate()).to.be.false;
			done();
		});

		it("getMaskedOutFields()", function (done) {
			expect(new ObjectMask(mask1).getMaskedOutFields(obj1).sort()).to.deep.equal(["num2", "undef", "obj.baz", "arr.0.str2", "arr.1.str2"].sort());
			done();
		});

		it("filterDottedObject()", function (done) {
			var dottedObj = objtools.collapseToDotted(obj1);
			var filtered = new ObjectMask(mask2).filterDottedObject(dottedObj);
			expect(filtered).to.deep.equal({
				str1: "string",
				num2: 2,
				nul2: null,
				"obj.bar": "test2",
				"obj.baz": "test3",
				"arr.0.str2": "two",
				"arr.1.str2": "four"
			});
			done();
		});

		it("getDottedMaskedOutFields()", function (done) {
			var dottedObj = objtools.collapseToDotted(obj1);
			var fields = new ObjectMask(mask1).getDottedMaskedOutFields(dottedObj);
			expect(fields).to.deep.equal(["num2", "undef", "obj.baz", "arr.0.str2", "arr.1.str2"]);
			done();
		});

		it("checkFields()", function (done) {
			var mask = new ObjectMask(mask1);
			expect(mask.checkFields({ str1: 5 })).to.be.true;
			expect(mask.checkFields({ num2: 5 })).to.be.false;
			expect(mask.checkFields({ obj: { foo: 5 } })).to.be.true;
			expect(mask.checkFields({ obj: { baz: 5 } })).to.be.false;
			done();
		});

		it("checkDottedFields()", function (done) {
			var mask = new ObjectMask(mask1);
			expect(mask.checkDottedFields({ "obj.foo": 5 })).to.be.true;
			expect(mask.checkDottedFields({ "obj.baz": 5 })).to.be.false;
			done();
		});

		it("createMaskFromFieldList()", function (done) {
			var fields = ["foo", "bar.baz", "bar.baz.biz"];
			expect(ObjectMask.createMaskFromFieldList(fields).toObject()).to.deep.equal({
				foo: true,
				bar: {
					baz: true
				}
			});
			done();
		});

		it("createFilterFunc()", function (done) {
			var func = new ObjectMask(mask1).createFilterFunc();
			expect(func(obj1)).to.deep.equal({
				str1: "string",
				str2: "string2",
				num1: 1,
				nul1: null,
				nul2: null,
				obj: {
					foo: "test",
					bar: "test2"
				},
				arr: [{
					str1: "one"
				}, {
					str1: "three"
				}]
			});
			done();
		});
	});
});
//# sourceMappingURL=data:application/json;base64,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QUFvQixFQUFFLFVBQVMsSUFBSSxFQUFFO0FBQ3ZDLE9BQUksSUFBSSxHQUFHLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7QUFDcEQsU0FBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0FBQ2hDLFFBQUksRUFBRSxRQUFRO0FBQ2QsUUFBSSxFQUFFLFNBQVM7QUFDZixRQUFJLEVBQUUsQ0FBQztBQUNQLFFBQUksRUFBRSxJQUFJO0FBQ1YsUUFBSSxFQUFFLElBQUk7QUFDVixPQUFHLEVBQUU7QUFDSixRQUFHLEVBQUUsTUFBTTtBQUNYLFFBQUcsRUFBRSxPQUFPO0tBQ1o7QUFDRCxPQUFHLEVBQUUsQ0FDSjtBQUNDLFNBQUksRUFBRSxLQUFLO0tBQ1gsRUFDRDtBQUNDLFNBQUksRUFBRSxPQUFPO0tBQ2IsQ0FDRDtJQUNELENBQUMsQ0FBQztBQUNILE9BQUksRUFBRSxDQUFDO0dBQ1AsQ0FBQyxDQUFDO0VBRUgsQ0FBQyxDQUFDO0NBRUgsQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3Qvb2JqZWN0LW1hc2suanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwZWN0ID0gcmVxdWlyZSgnY2hhaScpLmV4cGVjdDtcbnZhciBvYmp0b29scyA9IHJlcXVpcmUoJy4uL2xpYicpO1xudmFyIE9iamVjdE1hc2sgPSBvYmp0b29scy5PYmplY3RNYXNrO1xuXG5kZXNjcmliZSgnT2JqZWN0TWFzaycsIGZ1bmN0aW9uKCkge1xuXG5cdHZhciBvYmoxID0ge1xuXHRcdHN0cjE6ICdzdHJpbmcnLFxuXHRcdHN0cjI6ICdzdHJpbmcyJyxcblx0XHRudW0xOiAxLFxuXHRcdG51bTI6IDIsXG5cdFx0bnVsMTogbnVsbCxcblx0XHRudWwyOiBudWxsLFxuXHRcdHVuZGVmOiB1bmRlZmluZWQsXG5cdFx0b2JqOiB7XG5cdFx0XHRmb286ICd0ZXN0Jyxcblx0XHRcdGJhcjogJ3Rlc3QyJyxcblx0XHRcdGJhejogJ3Rlc3QzJ1xuXHRcdH0sXG5cdFx0YXJyOiBbXG5cdFx0XHR7XG5cdFx0XHRcdHN0cjE6ICdvbmUnLFxuXHRcdFx0XHRzdHIyOiAndHdvJ1xuXHRcdFx0fSxcblx0XHRcdHtcblx0XHRcdFx0c3RyMTogJ3RocmVlJyxcblx0XHRcdFx0c3RyMjogJ2ZvdXInXG5cdFx0XHR9XG5cdFx0XVxuXHR9O1xuXG5cdHZhciBtYXNrMSA9IHtcblx0XHRzdHIxOiB0cnVlLFxuXHRcdHN0cjI6IHRydWUsXG5cdFx0bnVtMTogdHJ1ZSxcblx0XHRudWwxOiB0cnVlLFxuXHRcdG51bDI6IHRydWUsXG5cdFx0b2JqOiB7XG5cdFx0XHRmb286IHRydWUsXG5cdFx0XHRiYXI6IHRydWVcblx0XHR9LFxuXHRcdGFycjogW1xuXHRcdFx0e1xuXHRcdFx0XHRzdHIxOiB0cnVlXG5cdFx0XHR9XG5cdFx0XVxuXHR9O1xuXG5cdHZhciBtYXNrMiA9IHtcblx0XHRzdHIxOiB0cnVlLFxuXHRcdG51bTI6IHRydWUsXG5cdFx0bnVsMjogdHJ1ZSxcblx0XHRvYmo6IHtcblx0XHRcdF86IHRydWUsXG5cdFx0XHRmb286IGZhbHNlXG5cdFx0fSxcblx0XHRhcnI6IFtcblx0XHRcdHtcblx0XHRcdFx0c3RyMjogdHJ1ZVxuXHRcdFx0fVxuXHRcdF1cblx0fTtcblxuXHRkZXNjcmliZSgnZmlsdGVyT2JqZWN0KCknLCBmdW5jdGlvbigpIHtcblxuXHRcdGl0KCdiYXNpYyBmdW5jdGlvbmFsaXR5JywgZnVuY3Rpb24oZG9uZSkge1xuXHRcdFx0b2JqMSA9IG9ianRvb2xzLmRlZXBDb3B5KG9iajEpO1xuXHRcdFx0dmFyIHJlc3VsdDtcblx0XHRcdHJlc3VsdCA9IG5ldyBPYmplY3RNYXNrKHtcblx0XHRcdFx0c3RyMTogdHJ1ZSxcblx0XHRcdFx0bnVtMTogdHJ1ZSxcblx0XHRcdFx0bnVsMTogdHJ1ZSxcblx0XHRcdFx0b2JqOiB7XG5cdFx0XHRcdFx0YmFyOiB0cnVlLFxuXHRcdFx0XHRcdG5vbmV4aXN0OiB0cnVlXG5cdFx0XHRcdH1cblx0XHRcdH0pLmZpbHRlck9iamVjdChvYmoxKTtcblx0XHRcdGV4cGVjdChyZXN1bHQpLnRvLmRlZXAuZXF1YWwoe1xuXHRcdFx0XHRzdHIxOiAnc3RyaW5nJyxcblx0XHRcdFx0bnVtMTogMSxcblx0XHRcdFx0bnVsMTogbnVsbCxcblx0XHRcdFx0b2JqOiB7XG5cdFx0XHRcdFx0YmFyOiAndGVzdDInXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0ZG9uZSgpO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ2FycmF5cyBhbmQgd2lsZGNhcmRzJywgZnVuY3Rpb24oZG9uZSkge1xuXHRcdFx0b2JqMSA9IG9ianRvb2xzLmRlZXBDb3B5KG9iajEpO1xuXHRcdFx0dmFyIHJlc3VsdDtcblx0XHRcdHJlc3VsdCA9IG5ldyBPYmplY3RNYXNrKHtcblx0XHRcdFx0b2JqOiB7XG5cdFx0XHRcdFx0XzogdHJ1ZSxcblx0XHRcdFx0XHRiYXI6IGZhbHNlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGFycjogW1xuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHN0cjI6IHRydWVcblx0XHRcdFx0XHR9XG5cdFx0XHRcdF1cblx0XHRcdH0pLmZpbHRlck9iamVjdChvYmoxKTtcblx0XHRcdGV4cGVjdChyZXN1bHQpLnRvLmRlZXAuZXF1YWwoe1xuXHRcdFx0XHRvYmo6IHtcblx0XHRcdFx0XHRmb286ICd0ZXN0Jyxcblx0XHRcdFx0XHRiYXo6ICd0ZXN0Mydcblx0XHRcdFx0fSxcblx0XHRcdFx0YXJyOiBbXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c3RyMjogJ3R3bydcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHN0cjI6ICdmb3VyJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XVxuXHRcdFx0fSk7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0XHRpdCgnZ2V0U3ViTWFzaygpJywgZnVuY3Rpb24oZG9uZSkge1xuXHRcdFx0ZXhwZWN0KG5ldyBPYmplY3RNYXNrKHtcblx0XHRcdFx0Zm9vOiB7XG5cdFx0XHRcdFx0YmFyOiB7XG5cdFx0XHRcdFx0XHRiYXo6IHRydWVcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pLmdldFN1Yk1hc2soJ2ZvbycpLnRvT2JqZWN0KCkpLnRvLmRlZXAuZXF1YWwoe1xuXHRcdFx0XHRiYXI6IHtcblx0XHRcdFx0XHRiYXo6IHRydWVcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0XHRpdCgnY2hlY2tQYXRoKCknLCBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHRleHBlY3QobmV3IE9iamVjdE1hc2sobWFzazEpLmNoZWNrUGF0aCgnYXJyLjguc3RyMScpKS50by5iZS50cnVlO1xuXHRcdFx0ZXhwZWN0KG5ldyBPYmplY3RNYXNrKG1hc2sxKS5jaGVja1BhdGgoJ2Fyci44LnN0cjInKSkudG8uYmUuZmFsc2U7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0XHRpdCgnYWRkTWFza3MoKScsIGZ1bmN0aW9uKGRvbmUpIHtcblx0XHRcdGV4cGVjdChPYmplY3RNYXNrLmFkZE1hc2tzKG5ldyBPYmplY3RNYXNrKG1hc2sxKSwgbmV3IE9iamVjdE1hc2sobWFzazIpKS50b09iamVjdCgpKS50by5kZWVwLmVxdWFsKHtcblx0XHRcdFx0c3RyMTogdHJ1ZSxcblx0XHRcdFx0c3RyMjogdHJ1ZSxcblx0XHRcdFx0bnVtMTogdHJ1ZSxcblx0XHRcdFx0bnVtMjogdHJ1ZSxcblx0XHRcdFx0bnVsMTogdHJ1ZSxcblx0XHRcdFx0bnVsMjogdHJ1ZSxcblx0XHRcdFx0b2JqOiB7XG5cdFx0XHRcdFx0XzogdHJ1ZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRhcnI6IHtcblx0XHRcdFx0XHRfOiB7XG5cdFx0XHRcdFx0XHRzdHIxOiB0cnVlLFxuXHRcdFx0XHRcdFx0c3RyMjogdHJ1ZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0XHRpdCgnYW5kTWFza3MoKScsIGZ1bmN0aW9uKGRvbmUpIHtcblx0XHRcdGV4cGVjdChPYmplY3RNYXNrLmFuZE1hc2tzKG5ldyBPYmplY3RNYXNrKG1hc2sxKSwgbmV3IE9iamVjdE1hc2sobWFzazIpKS50b09iamVjdCgpKS50by5kZWVwLmVxdWFsKHtcblx0XHRcdFx0c3RyMTogdHJ1ZSxcblx0XHRcdFx0bnVsMjogdHJ1ZSxcblx0XHRcdFx0b2JqOiB7XG5cdFx0XHRcdFx0YmFyOiB0cnVlXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0ZG9uZSgpO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ3ZhbGlkYXRlKCknLCBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHRleHBlY3QobmV3IE9iamVjdE1hc2sobWFzazEpLnZhbGlkYXRlKCkpLnRvLmJlLnRydWU7XG5cdFx0XHRleHBlY3QobmV3IE9iamVjdE1hc2sobWFzazIpLnZhbGlkYXRlKCkpLnRvLmJlLnRydWU7XG5cdFx0XHRleHBlY3QobmV3IE9iamVjdE1hc2soe1xuXHRcdFx0XHRmb286IG5ldyBEYXRlKClcblx0XHRcdH0pLnZhbGlkYXRlKCkpLnRvLmJlLmZhbHNlO1xuXHRcdFx0ZG9uZSgpO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ2dldE1hc2tlZE91dEZpZWxkcygpJywgZnVuY3Rpb24oZG9uZSkge1xuXHRcdFx0ZXhwZWN0KG5ldyBPYmplY3RNYXNrKG1hc2sxKS5nZXRNYXNrZWRPdXRGaWVsZHMob2JqMSkuc29ydCgpKS50by5kZWVwLmVxdWFsKFtcblx0XHRcdFx0J251bTInLFxuXHRcdFx0XHQndW5kZWYnLFxuXHRcdFx0XHQnb2JqLmJheicsXG5cdFx0XHRcdCdhcnIuMC5zdHIyJyxcblx0XHRcdFx0J2Fyci4xLnN0cjInXG5cdFx0XHRdLnNvcnQoKSk7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0XHRpdCgnZmlsdGVyRG90dGVkT2JqZWN0KCknLCBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHR2YXIgZG90dGVkT2JqID0gb2JqdG9vbHMuY29sbGFwc2VUb0RvdHRlZChvYmoxKTtcblx0XHRcdHZhciBmaWx0ZXJlZCA9IG5ldyBPYmplY3RNYXNrKG1hc2syKS5maWx0ZXJEb3R0ZWRPYmplY3QoZG90dGVkT2JqKTtcblx0XHRcdGV4cGVjdChmaWx0ZXJlZCkudG8uZGVlcC5lcXVhbCh7XG5cdFx0XHRcdHN0cjE6ICdzdHJpbmcnLFxuXHRcdFx0XHRudW0yOiAyLFxuXHRcdFx0XHRudWwyOiBudWxsLFxuXHRcdFx0XHQnb2JqLmJhcic6ICd0ZXN0MicsXG5cdFx0XHRcdCdvYmouYmF6JzogJ3Rlc3QzJyxcblx0XHRcdFx0J2Fyci4wLnN0cjInOiAndHdvJyxcblx0XHRcdFx0J2Fyci4xLnN0cjInOiAnZm91cidcblx0XHRcdH0pO1xuXHRcdFx0ZG9uZSgpO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ2dldERvdHRlZE1hc2tlZE91dEZpZWxkcygpJywgZnVuY3Rpb24oZG9uZSkge1xuXHRcdFx0dmFyIGRvdHRlZE9iaiA9IG9ianRvb2xzLmNvbGxhcHNlVG9Eb3R0ZWQob2JqMSk7XG5cdFx0XHR2YXIgZmllbGRzID0gbmV3IE9iamVjdE1hc2sobWFzazEpLmdldERvdHRlZE1hc2tlZE91dEZpZWxkcyhkb3R0ZWRPYmopO1xuXHRcdFx0ZXhwZWN0KGZpZWxkcykudG8uZGVlcC5lcXVhbChbXG5cdFx0XHRcdCdudW0yJyxcblx0XHRcdFx0J3VuZGVmJyxcblx0XHRcdFx0J29iai5iYXonLFxuXHRcdFx0XHQnYXJyLjAuc3RyMicsXG5cdFx0XHRcdCdhcnIuMS5zdHIyJ1xuXHRcdFx0XSk7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0XHRpdCgnY2hlY2tGaWVsZHMoKScsIGZ1bmN0aW9uKGRvbmUpIHtcblx0XHRcdHZhciBtYXNrID0gbmV3IE9iamVjdE1hc2sobWFzazEpO1xuXHRcdFx0ZXhwZWN0KG1hc2suY2hlY2tGaWVsZHMoeyBzdHIxOiA1IH0pKS50by5iZS50cnVlO1xuXHRcdFx0ZXhwZWN0KG1hc2suY2hlY2tGaWVsZHMoeyBudW0yOiA1IH0pKS50by5iZS5mYWxzZTtcblx0XHRcdGV4cGVjdChtYXNrLmNoZWNrRmllbGRzKHsgb2JqOiB7IGZvbzogNSB9IH0pKS50by5iZS50cnVlO1xuXHRcdFx0ZXhwZWN0KG1hc2suY2hlY2tGaWVsZHMoeyBvYmo6IHsgYmF6OiA1IH0gfSkpLnRvLmJlLmZhbHNlO1xuXHRcdFx0ZG9uZSgpO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ2NoZWNrRG90dGVkRmllbGRzKCknLCBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHR2YXIgbWFzayA9IG5ldyBPYmplY3RNYXNrKG1hc2sxKTtcblx0XHRcdGV4cGVjdChtYXNrLmNoZWNrRG90dGVkRmllbGRzKHsgJ29iai5mb28nOiA1IH0pKS50by5iZS50cnVlO1xuXHRcdFx0ZXhwZWN0KG1hc2suY2hlY2tEb3R0ZWRGaWVsZHMoeyAnb2JqLmJheic6IDUgfSkpLnRvLmJlLmZhbHNlO1xuXHRcdFx0ZG9uZSgpO1xuXHRcdH0pO1xuXG5cdFx0aXQoJ2NyZWF0ZU1hc2tGcm9tRmllbGRMaXN0KCknLCBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHR2YXIgZmllbGRzID0gWyAnZm9vJywgJ2Jhci5iYXonLCAnYmFyLmJhei5iaXonIF07XG5cdFx0XHRleHBlY3QoT2JqZWN0TWFzay5jcmVhdGVNYXNrRnJvbUZpZWxkTGlzdChmaWVsZHMpLnRvT2JqZWN0KCkpLnRvLmRlZXAuZXF1YWwoe1xuXHRcdFx0XHRmb286IHRydWUsXG5cdFx0XHRcdGJhcjoge1xuXHRcdFx0XHRcdGJhejogdHJ1ZVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdGRvbmUoKTtcblx0XHR9KTtcblxuXHRcdGl0KCdjcmVhdGVGaWx0ZXJGdW5jKCknLCBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHR2YXIgZnVuYyA9IG5ldyBPYmplY3RNYXNrKG1hc2sxKS5jcmVhdGVGaWx0ZXJGdW5jKCk7XG5cdFx0XHRleHBlY3QoZnVuYyhvYmoxKSkudG8uZGVlcC5lcXVhbCh7XG5cdFx0XHRcdHN0cjE6ICdzdHJpbmcnLFxuXHRcdFx0XHRzdHIyOiAnc3RyaW5nMicsXG5cdFx0XHRcdG51bTE6IDEsXG5cdFx0XHRcdG51bDE6IG51bGwsXG5cdFx0XHRcdG51bDI6IG51bGwsXG5cdFx0XHRcdG9iajoge1xuXHRcdFx0XHRcdGZvbzogJ3Rlc3QnLFxuXHRcdFx0XHRcdGJhcjogJ3Rlc3QyJ1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRhcnI6IFtcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRzdHIxOiAnb25lJ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c3RyMTogJ3RocmVlJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XVxuXHRcdFx0fSk7XG5cdFx0XHRkb25lKCk7XG5cdFx0fSk7XG5cblx0fSk7XG5cbn0pO1xuIl19